# JavaScript build process example

## Running the application

```
yarn install
yarn build
open public/index.html
```

### Expected behaviour

* A title in the center of a greenish background is seen on the page
* "I'm a robot" is logged to browser console

## Explanation

### Dependency installation

```
yarn install
```
Installs all the dependencies that are listed in package.json. The
dependencies usually target the NPM repository, but can target a public VCS
repository (e.g GitHub). The `npm` dependency management and installation
tool can also be used, but `yarn` has mostly superceded it by much faster and
having saner defaults.

* [Yarn][-3]
* [NPM repository][-2]
* [NPM CLI][-1]

### Build scripts

```
yarn build
```
`build` refers to the `build` script that is defined in
[_package.json_](https://github.com/urmastalimaa/interactive-frontend-development/tree/master/lecture_1/package.json#L28).
This is equivalent to running `./node_modules/.bin/webpack --config
webpack.config.js` from the command line.

### Webpack

Webpack generates a JavaScript file (_public/app.js_) using the specified
configuration file
([_webpack.config.js_](https://github.com/urmastalimaa/interactive-frontend-development/tree/master/lecture_1/webpack.config.js)).
Webpack resolves all module imports and outputs one file that can be included
in the browser using a `<script>` tag. Various plugins can be included in the
Webpack build process to perform additional changes to the source files.

#### Babel

JavaScript is a fast-changing language with many different runtimes (browsers
and their versions). Babel allows using desired JavaScript features and syntax
in the source code and _transpiling_ the source code to be parseable and
executable by various browsers and their versions.

`babel-loader` plugin is used (configured in webpack.config.js) to transpile
files with Babel during the Webpack build process. It uses `@babel/preset-env`
to target specific browsers([specified using browserlist][0]) and also defines
plugins that babel can use to further transform source code.

Compare the distribution JavaScript file generated by `yarn build` with the
files in src/.  Try running `yarn build` with different browser targets (i.e
remove "IE 10") and see how the distribution file changes (search for `class`).

#### Building on source file change

`yarn build:watch` refers to the `build:watch` script that is defined in
[_package.json_](https://github.com/urmastalimaa/interactive-frontend-development/tree/master/lecture_1/package.json#L29).
This is equivalent to running `./node_modules/.bin/webpack --config
webpack.config.js --watch`. The `watch` flag instructs Webpack to automatically
rebuild the bundle whenever any source file changes. New changes are visible
after refreshing the web application in the browser.

[Learn more][1]

#### Refreshing whenever source files change

`yarn start` refers to the `start` script that is defined in
[_package.json_](https://github.com/urmastalimaa/interactive-frontend-development/tree/master/lecture_1/package.json#L30).
This is equivalent to running `./node_modules/.bin/webpack-dev-server --open
--config webpack.config.js`. The `open` flag opens the default browser on the
specified port (default 8080) on localhost.

Try changing
[src/index.js](https://github.com/urmastalimaa/interactive-frontend-development/tree/master/lecture_1/src/index.js)
and see that the browser pages refreshes automatically once you save your
change.

[Learn more][2]

#### Source Maps

[_webpack.config.js_](https://github.com/urmastalimaa/interactive-frontend-development/tree/master/lecture_1/webpack.config.js#L13)
defines `devtool: "inline-source-map"` which instructs Webpack to add a link to
the source code definitions to the end of app.js.  This link is call a _source
map_.

A _source map_ is a file which maps the transformed source (app.js) to the
original source (multiple files in src.js). In the current case, a _source map_
isn't an URL to a file, but a base64 encoding of the whole source definition in
base64. A web-browser will map the generated file (app.js) to the original
source. This allows both the browser to execute JavaScript that it supports and
the developer to debug their original, unchanged source code.

[Learn more][3]

[-3]: https://yarnpkg.com/en/
[-2]: https://www.npmjs.com/
[-1]: https://docs.npmjs.com/getting-started/what-is-npm
[0]: https://github.com/ai/browserslist
[1]: https://webpack.js.org/guides/development/#using-watch-mode
[2]: https://webpack.js.org/guides/development/#using-webpack-dev-server
[3]: https://webpack.js.org/guides/development/#using-source-maps
